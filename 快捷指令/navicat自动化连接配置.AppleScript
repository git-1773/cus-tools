-- åº”ç”¨ç¨‹åºåç§°å’Œå¯†ç è®¾ç½®
set app_name to "Navicat Premium"
set target_connection_name to "aldi-aim-dev-1118"
set db_password to "Your_Actual_Password_Here"

-- UI å…ƒç´ åç§° (æ ¹æ®æ‚¨çš„ä¸­æ–‡ç•Œé¢å¯èƒ½éœ€è¦ä¿®æ”¹)
set password_window_name to "Connection Password"
set edit_menu_item to "ç¼–è¾‘è¿æ¥..." -- ç¡®ä¿æ‚¨ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªç²¾ç¡®çš„ä¸­æ–‡åç§°
set ok_button_name to "ç¡®å®š"       -- ç¡®ä¿ä½¿ç”¨ä¸­æ–‡ "ç¡®å®š"


-- 1. æ¿€æ´» Navicat
tell application app_name
    activate
end tell

tell application "System Events"
    tell process app_name

        -- ç­‰å¾… Navicat çª—å£å®Œå…¨åŠ è½½
        delay 5

        -- 2. å¼ºåˆ¶è·å–è¿æ¥åˆ—è¡¨ç„¦ç‚¹
        repeat 3 times
            keystroke tab
            delay 0.2
        end repeat

        -- ---------------------------------------------
        -- 2. ğŸ¯ éªŒè¯ç‚¹ï¼šä½¿ç”¨ try/catch å—æ›¿ä»£å¤æ‚çš„ return
        -- ---------------------------------------------

        -- å°è¯•è·å–å½“å‰ç„¦ç‚¹å…ƒç´ çš„è§’è‰²
--        try
--            -- set focused_element_role to role of attribute "AXFocused" of window 1
--        on error
--            display dialog "é”™è¯¯ï¼šæ— æ³•è·å–ç„¦ç‚¹å±æ€§ã€‚è¯·æ£€æŸ¥ Navicat çš„ Accessibility æƒé™ï¼" with title "ç„¦ç‚¹è°ƒè¯•"
--            error number -128 -- æ¨¡æ‹Ÿé€€å‡º
--        end try
--
--        -- æ£€æŸ¥è§’è‰²æ˜¯å¦æ˜¯åˆ—è¡¨æˆ–è¡¨æ ¼ç±»å‹
--        if focused_element_role is not in {"AXOutline", "AXTable", "AXScrollArea", "AXGroup"} then
--            display dialog "é”™è¯¯ï¼šå½“å‰ç„¦ç‚¹è§’è‰²æ˜¯ " & focused_element_role & ", é¢„æœŸæ˜¯åˆ—è¡¨/è¡¨æ ¼ï¼" with title "éªŒè¯å¤±è´¥"
--            error number -128 -- æ¨¡æ‹Ÿé€€å‡ºï¼Œä»¥ä¾¿æ‚¨ä¿®æ”¹ Tab æ¬¡æ•°
--        end if
--
--        display dialog "âœ… éªŒè¯é€šè¿‡ï¼ç„¦ç‚¹è§’è‰²æ˜¯: " & focused_element_role with title "éªŒè¯æˆåŠŸ"

        -- 3. é€‰ä¸­ç›®æ ‡è¿æ¥
        keystroke target_connection_name
        delay 1

        -- 4. æ¨¡æ‹Ÿå³é”®ç‚¹å‡» (ä¸Šä¸‹æ–‡èœå•)
        keystroke space using {control down}
        delay 1 -- ä¿®æ­£å»¶è¿Ÿæ—¶é—´ä¸º 1 ç§’

        -- 5. é€‰æ‹©å¹¶ç‚¹å‡»èœå•é¡¹ "ç¼–è¾‘è¿æ¥"
        -- å‡è®¾ä¸Šä¸‹æ–‡èœå•æ˜¯å½“å‰è¿›ç¨‹çš„ menu 1
        click menu item edit_menu_item of menu 1 of entire menu bar
        delay 1

        -- 6. ç­‰å¾…â€œç¼–è¾‘è¿æ¥â€é…ç½®çª—å£å¼¹å‡º
        delay 2

        -- 7. å¯†ç è¾“å…¥å’Œç‚¹å‡» OK

        -- å‡è®¾é…ç½®çª—å£æ ‡é¢˜æ ¼å¼æ˜¯è¿™æ · (è¯·æ‰‹åŠ¨ç¡®è®¤)
        set config_window_name to "Edit Connection: " & target_connection_name

        -- æ£€æŸ¥é…ç½®çª—å£æ˜¯å¦å­˜åœ¨
        if window config_window_name exists then

            set config_window to window config_window_name

            -- æŸ¥æ‰¾å¯†ç è¾“å…¥æ¡†
            set password_field to secure text field 1 of config_window

            -- è¾“å…¥å¯†ç 
            set value of password_field to db_password

            -- æ¨¡æ‹Ÿç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®ä¿å­˜é…ç½®
            click button ok_button_name of config_window
        else
            -- å¦‚æœçª—å£åä¸å¯¹æˆ–æœªå¼¹å‡ºï¼Œæ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
            display dialog "é”™è¯¯ï¼šé…ç½®çª—å£æœªå¼¹å‡ºæˆ–çª—å£åä¸åŒ¹é…ã€‚è¯·æ£€æŸ¥ï¼š[" & config_window_name & "]"
            log "Configuration window did not appear or name is incorrect."
        end if

    end tell
end tell